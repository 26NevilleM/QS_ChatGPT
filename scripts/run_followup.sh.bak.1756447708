#!/usr/bin/env bash
set -euo pipefail
casefile="${1:?path to case json}"
command -v jq >/dev/null 2>&1 || { echo "❌ jq required"; exit 1; }
recipient="$(jq -r .recipient "$casefile")"
sender="$(jq -r .sender "$casefile")"
days="$(jq -r .last_contact_days "$casefile")"
context="$(jq -r .context "$casefile")"
plural="s"; [ "$days" = "1" ] && plural=""

# Compose a concise message body (no markdown headings)
printf "Hi %s,\\n\\n" "$recipient"
if [ -n "$context" ] && [ "$context" != "null" ]; then
  printf "Just a quick note after %s day%s to keep things moving on %s.\\n" "$days" "$plural" "$context"
else
  printf "Just a quick note after %s day%s to keep things moving and align on next steps.\\n" "$days" "$plural"
fi
printf "If helpful, I can share a brief next step or answer any questions — whatever is easiest on your side.\\n\\n"
printf "Best,\\n%s\\n" "$sender"
